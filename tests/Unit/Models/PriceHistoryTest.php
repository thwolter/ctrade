<?php

namespace App\Tests\Unit\Models;

use Tests\TestCase;
use Illuminate\Foundation\Testing\DatabaseMigrations;
use Illuminate\Foundation\Testing\DatabaseTransactions;
use App\Models\PriceHistory;

class PriceHistoryTest extends TestCase
{

    protected $json = '{"dataset":{"id":13089392,"dataset_code":"PNT","database_code":"SSE","name":"PENTAIR STOCK WKN A115FG | ISIN IE00BLS09M33 (PNT) - Stuttgart","description":"Stock Prices for Pentair Stock WKN A115FG | ISIN IE00BLS09M33 from the Boerse Stuttgart. Currency:EUR; Sector: Utilities - Environment-technology \u0026 Waste Disposal","refreshed_at":"2017-06-09T21:36:03.286Z","newest_available_date":"2017-06-09","oldest_available_date":"2014-07-10","column_names":["Date","High","Low","Last","Previous Day Price","Volume"],"frequency":"daily","type":"Time Series","premium":false,"limit":250,"transform":null,"column_index":null,"start_date":"2014-07-10","end_date":"2017-06-09","data":[["2017-06-09",58.525,57.456,58.525,56.95,0.0],["2017-06-08",56.95,56.854,56.95,56.959,0.0],["2017-06-07",57.192,56.959,56.959,56.681,0.0],["2017-06-06",57.579,56.681,56.681,58.932,0.0],["2017-06-02",58.932,58.932,58.932,58.455,0.0],["2017-06-01",58.7,58.303,58.455,58.322,0.0],["2017-05-31",59.98,58.067,58.322,58.783,500.0],["2017-05-30",59.22,58.541,58.783,59.1,0.0],["2017-05-29",59.1,59.05,59.1,58.431,0.0],["2017-05-26",59.104,58.37,58.431,58.613,0.0],["2017-05-25",59.227,58.613,58.613,58.72,0.0],["2017-05-24",59.067,58.72,58.72,58.729,0.0],["2017-05-23",60.108,58.729,58.729,60.85,0.0],["2017-05-22",60.85,59.198,60.85,59.278,30.0],["2017-05-19",59.533,59.062,59.278,58.934,200.0],["2017-05-18",58.934,57.755,58.934,57.992,0.0],["2017-05-17",58.75,57.992,57.992,59.78,60.0],["2017-05-16",59.78,59.0,59.78,59.1,100.0],["2017-05-15",59.1,59.0,59.1,58.726,16.0],["2017-05-12",59.427,58.726,58.726,60.307,0.0],["2017-05-11",60.354,60.307,60.307,60.196,0.0],["2017-05-10",61.92,60.196,60.196,61.6,0.0],["2017-05-09",63.105,60.205,61.6,60.03,600.0],["2017-05-08",60.371,59.959,60.03,59.593,5.0],["2017-05-05",59.593,59.029,59.593,58.725,0.0],["2017-05-04",59.854,58.725,58.725,59.442,0.0],["2017-05-03",59.442,58.286,59.442,58.514,0.0],["2017-05-02",58.79,58.514,58.514,58.561,0.0],["2017-04-28",59.196,58.561,58.561,59.076,0.0],["2017-04-27",59.342,59.02,59.076,59.242,0.0],["2017-04-26",59.484,58.71,59.242,58.421,0.0],["2017-04-24",58.477,57.764,57.843,57.793,0.0],["2017-04-21",58.406,57.62,57.793,57.916,0.0],["2017-04-20",57.916,57.747,57.916,57.857,0.0],["2017-04-19",58.509,57.857,57.857,58.399,0.0],["2017-04-18",58.399,57.793,58.399,58.081,0.0],["2017-04-13",58.368,57.677,58.081,58.237,0.0],["2017-04-12",59.532,58.237,58.237,59.115,0.0],["2017-04-11",59.287,58.541,59.115,59.054,0.0],["2017-04-10",59.31,58.629,59.054,58.652,2000.0],["2017-04-07",58.841,58.461,58.652,58.47,0.0],["2017-04-06",58.47,57.979,58.47,59.015,0.0],["2017-04-05",59.015,58.184,59.015,58.212,0.0],["2017-04-04",58.212,57.613,58.212,58.6,0.0],["2017-04-03",59.5,58.579,58.6,58.379,40.0],["2017-03-31",58.435,58.316,58.379,58.385,0.0],["2017-03-30",58.385,58.385,58.385,57.393,0.0],["2017-03-29",58.051,57.393,57.393,57.322,0.0],["2017-03-28",57.322,55.837,57.322,55.468,0.0],["2017-03-27",55.468,54.347,55.468,56.068,0.0],["2017-03-24",56.488,56.068,56.068,56.246,0.0],["2017-03-23",56.314,55.946,56.246,55.598,0.0],["2017-03-22",56.059,55.598,55.598,55.987,0.0],["2017-03-21",57.55,55.987,55.987,57.144,0.0],["2017-03-20",57.629,57.063,57.144,57.974,0.0],["2017-03-17",58.064,57.716,57.974,57.756,0.0],["2017-03-16",58.278,57.756,57.756,58.441,0.0],["2017-03-15",58.441,56.639,58.441,55.774,0.0],["2017-03-14",56.808,55.766,55.774,56.229,0.0],["2017-03-13",56.229,55.6,56.229,55.524,0.0],["2017-03-10",55.824,55.228,55.524,55.34,0.0],["2017-03-09",56.0,55.34,55.34,55.607,11.0],["2017-03-08",55.689,55.35,55.607,55.13,0.0],["2017-03-07",55.278,55.13,55.13,55.006,0.0],["2017-03-06",55.413,55.006,55.006,54.79,0.0],["2017-03-03",55.382,54.79,54.79,55.97,0.0],["2017-03-02",56.559,55.97,55.97,56.143,0.0],["2017-03-01",56.143,54.793,56.143,54.184,0.0],["2017-02-28",54.954,54.032,54.184,54.863,0.0],["2017-02-27",54.863,54.199,54.863,54.462,0.0],["2017-02-24",54.815,54.119,54.462,54.555,0.0],["2017-02-23",55.456,54.555,54.555,55.133,0.0],["2017-02-22",56.101,55.133,55.133,54.954,0.0],["2017-02-21",54.954,54.721,54.954,54.215,1.0],["2017-02-20",54.612,54.215,54.215,54.114,0.0],["2017-02-17",54.514,53.808,54.114,54.127,0.0],["2017-02-16",55.372,54.121,54.127,55.214,0.0],["2017-02-15",55.231,54.646,55.214,55.025,0.0],["2017-02-14",55.653,55.025,55.025,55.126,0.0],["2017-02-10",54.612,54.244,54.472,53.986,0.0],["2017-02-09",54.152,53.986,53.986,53.54,0.0],["2017-02-08",54.3,53.54,53.54,53.679,0.0],["2017-02-07",54.031,53.569,53.679,53.502,0.0],["2017-02-06",53.963,53.502,53.502,53.497,0.0],["2017-02-03",53.699,53.346,53.497,53.199,0.0],["2017-02-02",53.355,52.919,53.199,53.423,0.0],["2017-02-01",54.465,53.423,53.423,54.269,1000.0],["2017-01-31",56.352,54.269,54.269,56.355,0.0],["2017-01-30",56.458,55.826,56.355,56.199,0.0],["2017-01-27",56.872,56.199,56.199,56.136,0.0],["2017-01-26",57.474,56.136,56.136,56.592,5.0],["2017-01-25",56.592,55.5,56.592,55.471,0.0],["2017-01-24",55.471,54.42,55.471,54.1,0.0],["2017-01-23",54.468,54.1,54.1,54.273,0.0],["2017-01-20",55.239,54.273,54.273,54.529,0.0],["2017-01-19",54.925,54.469,54.529,54.335,0.0],["2017-01-18",54.619,54.103,54.335,53.791,0.0],["2017-01-17",54.546,53.791,53.791,54.871,0.0],["2017-01-16",54.976,54.814,54.871,54.497,0.0],["2017-01-13",55.0,53.646,54.497,52.919,200.0],["2017-01-12",53.534,52.919,52.919,53.572,0.0],["2017-01-11",54.324,53.549,53.572,53.473,0.0],["2017-01-10",53.569,53.007,53.473,53.021,0.0],["2017-01-09",54.901,53.021,53.021,54.589,0.0],["2017-01-06",54.75,54.165,54.589,53.609,0.0],["2017-01-05",55.035,53.609,53.609,54.849,0.0],["2017-01-04",55.464,54.785,54.849,55.022,0.0],["2017-01-03",55.022,52.962,55.022,53.048,0.0],["2017-01-02",53.048,52.755,53.048,53.552,0.0],["2016-12-30",53.552,53.552,53.552,53.492,0.0],["2016-12-29",53.495,53.492,53.492,53.594,0.0],["2016-12-28",55.016,53.594,53.594,53.875,0.0],["2016-12-27",54.173,53.694,53.875,53.696,2.0],["2016-12-23",54.119,53.696,53.696,53.911,0.0],["2016-12-22",54.35,53.611,53.911,54.494,0.0],["2016-12-21",54.538,54.022,54.494,55.073,0.0],["2016-12-20",55.073,54.79,55.073,53.99,0.0],["2016-12-19",54.088,53.642,53.99,53.697,0.0],["2016-12-16",54.638,53.697,53.697,54.768,0.0],["2016-12-15",55.098,54.359,54.768,54.761,0.0],["2016-12-14",55.213,54.59,54.761,54.901,0.0],["2016-12-13",56.383,54.722,54.901,55.643,0.0],["2016-12-12",56.652,55.643,55.643,56.413,0.0],["2016-12-09",57.161,56.413,56.413,56.741,49.0],["2016-12-08",57.402,56.516,56.741,56.41,0.0],["2016-12-07",56.41,55.27,56.41,54.977,0.0],["2016-12-06",55.416,54.58,54.977,54.894,0.0],["2016-12-05",55.261,54.611,54.839,54.578,null],["2016-12-02",54.858,54.324,54.342,54.916,null],["2016-12-01",55.351,53.632,55.239,53.655,null],["2016-11-30",53.71,52.574,53.566,52.648,null],["2016-11-29",53.678,52.648,52.648,53.732,null],["2016-11-28",54.358,53.732,53.732,53.787,null],["2016-11-25",54.494,53.787,53.787,54.67,null],["2016-11-24",54.67,54.407,54.67,54.227,null],["2016-11-23",54.473,54.207,54.207,54.029,null],["2016-11-22",54.796,54.004,54.029,54.466,null],["2016-11-21",54.466,54.157,54.466,54.11,null],["2016-11-18",54.304,54.11,54.11,54.189,null],["2016-11-17",54.274,53.997,54.189,54.096,null],["2016-11-16",54.514,54.054,54.096,54.636,null],["2016-11-15",55.63,54.636,54.636,55.199,null],["2016-11-14",55.478,55.072,55.394,54.392,null],["2016-11-11",54.942,54.326,54.392,54.909,null],["2016-11-10",55.062,52.243,55.062,52.248,null],["2016-11-09",52.248,47.891,52.248,50.141,null],["2016-11-08",50.141,49.451,50.141,49.67,null],["2016-11-07",50.138,50.005,50.034,49.086,null],["2016-11-04",49.086,48.438,49.086,48.114,null],["2016-11-03",48.601,48.029,48.114,48.157,null],["2016-11-02",49.227,48.157,48.157,49.2,null],["2016-11-01",50.251,48.923,49.2,49.843,null],["2016-10-31",50.184,49.744,49.843,50.125,null],["2016-10-28",50.18,49.966,50.125,49.95,null],["2016-10-27",50.556,49.795,49.95,50.444,null],["2016-10-26",50.95,50.411,50.444,51.085,null],["2016-10-25",54.4,50.649,51.085,53.651,null],["2016-10-24",53.781,53.481,53.651,53.135,null],["2016-10-21",53.152,52.575,53.135,52.833,null],["2016-10-20",53.564,52.692,52.833,53.625,null],["2016-10-19",53.783,53.413,53.625,53.601,null],["2016-10-18",53.936,53.227,53.601,53.137,null],["2016-10-17",53.137,52.569,53.137,52.997,null],["2016-10-14",53.442,52.795,52.997,52.743,null],["2016-10-13",53.378,52.348,52.743,53.676,null],["2016-10-12",53.676,53.104,53.676,52.892,null],["2016-10-11",53.462,52.644,52.892,53.325,null],["2016-10-10",54.087,53.325,53.325,53.368,null],["2016-10-07",54.924,53.368,53.368,54.74,null],["2016-10-06",55.341,54.237,54.74,55.002,null],["2016-10-05",55.574,55.002,55.002,55.12,null],["2016-10-04",57.189,55.12,55.12,56.851,null],["2016-09-30",56.851,55.553,56.851,56.046,null],["2016-09-29",56.19,55.871,56.046,55.117,null],["2016-09-28",55.136,54.399,55.117,53.899,null],["2016-09-27",54.362,53.072,53.899,53.626,null],["2016-09-26",54.129,53.406,53.626,54.383,null],["2016-09-23",55.263,54.289,54.383,54.807,null],["2016-09-22",54.99,53.582,54.807,53.251,null],["2016-09-21",53.553,53.251,53.251,52.956,null],["2016-09-20",53.38,52.784,52.956,53.086,null],["2016-09-19",53.22,52.955,53.086,52.193,null],["2016-09-16",52.193,51.61,52.193,52.009,null],["2016-09-15",52.134,52.009,52.009,51.602,null],["2016-09-14",52.259,51.55,51.602,52.078,null],["2016-09-13",53.39,51.837,52.078,53.443,null],["2016-09-12",53.443,52.061,53.443,53.084,null],["2016-09-09",54.818,53.084,53.084,54.633,null],["2016-09-08",56.094,54.633,54.633,55.774,null],["2016-09-07",56.515,55.764,55.774,56.589,null],["2016-09-06",57.172,56.589,56.589,57.14,null],["2016-09-05",57.154,57.046,57.14,56.78,null],["2016-09-02",56.78,56.062,56.78,55.545,null],["2016-09-01",57.284,55.148,55.545,56.637,null],["2016-08-31",57.31,56.637,56.637,56.919,null],["2016-08-30",57.735,56.919,56.919,57.494,null],["2016-08-29",57.494,56.518,57.494,56.307,null],["2016-08-26",56.422,56.224,56.307,56.105,null],["2016-08-25",56.93,56.105,56.105,56.561,null],["2016-08-24",57.527,56.517,56.561,57.312,null],["2016-08-23",57.493,57.254,57.312,57.155,null],["2016-08-22",58.031,57.071,57.155,57.668,null],["2016-08-19",58.392,56.748,57.668,58.284,null],["2016-08-18",58.686,58.284,58.284,58.224,null],["2016-08-17",58.731,58.224,58.224,58.553,null],["2016-08-16",59.148,58.305,58.553,59.165,null],["2016-08-15",59.165,58.563,59.165,58.217,null],["2016-08-12",58.795,57.836,58.217,58.448,null],["2016-08-11",58.68,56.882,58.448,57.008,null],["2016-08-10",57.63,57.008,57.008,57.456,null],["2016-08-09",57.921,57.312,57.456,57.518,null],["2016-08-08",58.08,57.518,57.518,57.401,null],["2016-08-05",57.9,55.667,57.401,55.392,null],["2016-08-04",55.765,55.392,55.392,55.558,null],["2016-08-03",55.558,54.108,55.558,53.634,null],["2016-08-02",55.535,53.634,53.634,55.317,null],["2016-08-01",57.14,55.317,55.317,56.876,null],["2016-07-29",57.335,56.876,56.876,56.527,null],["2016-07-27",57.421,57.421,57.421,56.578,null],["2016-07-26",56.578,55.948,56.578,55.726,null],["2016-07-25",56.751,55.726,55.726,55.682,null],["2016-07-22",56.097,55.354,55.682,55.749,null],["2016-07-21",56.353,55.749,55.749,55.974,null],["2016-07-20",56.483,55.489,55.974,56.069,null],["2016-07-19",56.663,55.954,56.069,56.404,null],["2016-07-15",57.183,56.491,56.814,56.571,null],["2016-07-14",57.282,56.398,56.571,56.324,null],["2016-07-13",57.251,56.169,56.324,56.855,null],["2016-07-12",56.86,55.847,56.855,55.376,null],["2016-07-11",55.654,55.244,55.376,55.051,null],["2016-07-08",55.051,53.11,55.051,53.074,null],["2016-07-07",53.391,52.65,53.074,51.621,null],["2016-07-06",51.874,51.23,51.621,51.544,null],["2016-07-05",52.453,51.327,51.544,52.553,null],["2016-07-04",52.778,52.553,52.553,52.157,null],["2016-07-01",52.396,51.958,52.157,51.977,null],["2016-06-30",51.977,51.235,51.977,51.684,null],["2016-06-29",51.684,50.596,51.684,50.502,null],["2016-06-28",51.184,50.351,50.502,50.43,null],["2016-06-27",51.288,50.151,50.43,51.545,null],["2016-06-24",52.719,50.801,51.545,53.42,null],["2016-06-23",53.737,53.38,53.42,53.31,null],["2016-06-22",54.388,53.31,53.31,54.048,null],["2016-06-21",55.021,54.048,54.048,54.565,null],["2016-06-20",54.593,53.494,54.565,53.513,null],["2016-06-17",53.513,53.156,53.513,52.884,null],["2016-06-16",52.9,52.357,52.884,52.716,null],["2016-06-15",52.716,52.412,52.716,52.247,null],["2016-06-14",52.247,51.543,52.247,51.516,null],["2016-06-13",52.163,51.516,51.516,52.182,null]],"collapse":null,"order":null,"database_id":7330}}';
    
    protected $data;
    
    public function setUp()
    {
        parent::setUp();
        $this->data = json_decode($this->json, true)['dataset']['data'];
    }
    
    /** @test */
    public function a_history_is_normlized()
    {
        $history = (new PriceHistory($this->data, 4))->data();
        
        $this->assertTrue(is_array($history));
        $this->assertEquals('2017-06-09', key($history));
        $this->assertEquals(56.95, head($history));
    }
    
    /** @test */
    public function can_get_the_current_price()
    {
         $data = new PriceHistory($this->data, 4);
         
         $this->assertEquals(['2017-06-09' => 56.95], $data->price());
    }
    
    /** @test */
    public function can_get_the_price_date()
    {
        $data = new PriceHistory($this->data, 4);
         
        $this->assertEquals('2017-06-09', $data->priceDate());
    }
    
   
}
